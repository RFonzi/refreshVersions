# This file was generated using Kotlin DSL (build.main.kts).
# If you want to modify the workflow, please change the Kotlin file and regenerate this YAML file.
# Generated with https://github.com/krzema12/github-actions-kotlin-dsl

name: Check build and tests of plugins and samples

on:
  workflow_dispatch:
    inputs:
      run-refreshVersions-task:
        description: 'Run the refreshVersions task'
        type: boolean
        required: true
        default: 'false'
      sample-kotlin:
        description: 'Enable sample-kotlin'
        type: boolean
        required: true
        default: 'true'
      sample-groovy:
        description: 'Enable sample-groovy'
        type: boolean
        required: true
        default: 'true'
      sample-multi-modules:
        description: 'Enable sample-multi-modules'
        type: boolean
        required: true
        default: 'true'
      sample-kotlin-js:
        description: 'Enable sample-kotlin-js'
        type: boolean
        required: true
        default: 'true'
      sample-android:
        description: 'Enable sample-android'
        type: boolean
        required: true
        default: 'false'
      run-on:
        description: 'Where to run this workflow'
        type: choice
        required: true
        default: 'ubuntu-latest'
        options:
          - 'ubuntu-latest'
          - 'windows-latest'
          - 'macos-latest'
          - 'windows-2022'
          - 'windows-2019'
          - 'windows-2016'
          - 'ubuntu-20.04'
          - 'ubuntu-18.04'
          - 'macos-11'
          - 'macos-10.15'
  pull_request:
    paths:
      - 'plugins/**'
      - 'sample-kotlin/**'
      - 'sample-groovy/**'
      - '!**.md'
      - '!.editorconfig'
      - '!**/.gitignore'
      - '!**.adoc'
      - '!docs/**'
  push:
    branches:
      - 'main'
    paths:
      - 'plugins/**'
      - 'sample-kotlin/**'
      - 'sample-groovy/**'
      - '!**.md'
      - '!.editorconfig'
      - '!**/.gitignore'
      - '!**.adoc'
      - '!docs/**'

jobs:
  "check-all":
    runs-on: "ubuntu-latest"
    steps:
      - name: Enable long paths for git Windows
        run: git config --global core.longpaths true
        if: ${{ runner.os == 'Windows' }}
      - name: check-out
        uses: actions/checkout@v2
      - name: setup-java
        uses: actions/setup-java@v2
        with:
          java-version: 11
          distribution: adopt
      - name: Check plugins and publish them to MavenLocal
        uses: gradle/gradle-build-action@v2
        with:
          arguments: check publishToMavenLocal --stacktrace
          build-root-directory: plugins
          gradle-executable: plugins/gradlew
      - name: Run refreshVersions on sample-kotlin
        uses: gradle/gradle-build-action@v2
        with:
          arguments: refreshVersions --stacktrace
          build-root-directory: sample-kotlin
          gradle-executable: sample-kotlin/gradlew
        if: ${{  github.event.inputs.sample-kotlin == 'true' && github.event.inputs.run-refreshVersions-task == 'true'  }}
      - name: Check sample-kotlin
        uses: gradle/gradle-build-action@v2
        with:
          arguments: check --configuration-cache --stacktrace
          build-root-directory: sample-kotlin
          gradle-executable: sample-kotlin/gradlew
        if: ${{  github.event.inputs.sample-kotlin == 'true'  }}
      - name: Run refreshVersions on sample-groovy
        uses: gradle/gradle-build-action@v2
        with:
          arguments: refreshVersions --stacktrace
          build-root-directory: sample-groovy
          gradle-executable: sample-groovy/gradlew
        if: ${{  github.event.inputs.sample-groovy == 'true' && github.event.inputs.run-refreshVersions-task == 'true'  }}
      - name: Check sample-groovy
        uses: gradle/gradle-build-action@v2
        with:
          arguments: check --configuration-cache --stacktrace
          build-root-directory: sample-groovy
          gradle-executable: sample-groovy/gradlew
        if: ${{  github.event.inputs.sample-groovy == 'true'  }}
      - name: Check buildSrc of sample-groovy (simulates IDE Gradle sync)
        uses: gradle/gradle-build-action@v2
        with:
          arguments: help --stacktrace
          build-root-directory: sample-groovy
          gradle-executable: sample-groovy/gradlew
        if: ${{  github.event.inputs.sample-groovy == 'true'  }}
      - name: Run refreshVersions on sample-multi-modules
        uses: gradle/gradle-build-action@v2
        with:
          arguments: refreshVersions --stacktrace
          build-root-directory: sample-multi-modules/buidSrc
          gradle-executable: sample-multi-modules/gradlew
        if: ${{  github.event.inputs.sample-multi-modules == 'true' && github.event.inputs.run-refreshVersions-task == 'true'  }}
      - name: Check sample-multi-modules
        uses: gradle/gradle-build-action@v2
        with:
          arguments: check --configuration-cache --stacktrace
          build-root-directory: sample-multi-modules
          gradle-executable: sample-multi-modules/gradlew
        if: ${{  github.event.inputs.sample-multi-modules == 'true'  }}
      - name: Run refreshVersions on sample-kotlin-js
        uses: gradle/gradle-build-action@v2
        with:
          arguments: refreshVersions --stacktrace
          build-root-directory: sample-kotlin-js
          gradle-executable: sample-kotlin-js/gradlew
        if: ${{  github.event.inputs.sample-kotlin-js == 'true' && github.event.inputs.run-refreshVersions-task == 'true'  }}
      - name: Check sample-kotlin-js
        uses: gradle/gradle-build-action@v2
        with:
          arguments: check --stacktrace
          build-root-directory: sample-kotlin-js
          gradle-executable: sample-kotlin-js/gradlew
        if: ${{  github.event.inputs.sample-kotlin-js == 'true'  }}
      - name: Run refreshVersions on sample-android
        uses: gradle/gradle-build-action@v2
        with:
          arguments: refreshVersions --stacktrace
          build-root-directory: sample-android
          gradle-executable: sample-android/gradlew
        if: ${{  github.event.inputs.sample-android == 'true' && github.event.inputs.run-refreshVersions-task == 'true'  }}
      - name: Check sample-android
        uses: gradle/gradle-build-action@v2
        with:
          arguments: check --stacktrace
          build-root-directory: sample-android
          gradle-executable: sample-android/gradlew
        if: ${{  github.event.inputs.sample-android == 'true'  }}